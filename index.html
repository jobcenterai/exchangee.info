<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Menu Chat</title>

<style>
:root{
--bg:#0f172a;
--panel:#1e293b;
--accent:#3b82f6;
--soft:#334155;
--text:#e2e8f0;
--danger:#ef4444;
}

body{
margin:0;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:var(--bg);
color:var(--text);
display:flex;
flex-direction:column;
height:100vh;
}

/* TOP NAV */
.topbar{
display:flex;
background:var(--panel);
padding:10px 20px;
gap:20px;
border-bottom:1px solid var(--soft);
}

.nav-btn{
cursor:pointer;
font-weight:600;
}

.nav-btn.active{
color:var(--accent);
}

/* MAIN LAYOUT */
.main{
flex:1;
display:flex;
}

/* SIDEBAR */
.sidebar{
width:240px;
background:var(--panel);
padding:20px;
display:flex;
flex-direction:column;
gap:10px;
border-right:1px solid var(--soft);
}

.group{
padding:8px 10px;
background:var(--soft);
border-radius:8px;
cursor:pointer;
transition:.2s;
}

.group:hover{
background:var(--accent);
}

/* CONTENT */
.content{
flex:1;
padding:25px;
display:flex;
flex-direction:column;
}

.chat-box{
flex:1;
background:var(--panel);
border-radius:12px;
padding:15px;
overflow:auto;
display:flex;
flex-direction:column;
gap:8px;
}

.msg{
background:var(--soft);
padding:8px 10px;
border-radius:8px;
max-width:70%;
}

textarea{
resize:none;
padding:10px;
border-radius:10px;
border:1px solid var(--soft);
background:var(--panel);
color:var(--text);
margin-top:10px;
}

button{
background:var(--accent);
border:none;
padding:8px;
border-radius:8px;
cursor:pointer;
color:white;
font-weight:600;
margin-top:10px;
}

.status{
margin-top:10px;
font-size:13px;
}

.hidden{
display:none;
}
</style>
</head>
<body>

<!-- TOP MENU -->
<div class="topbar">
<div class="nav-btn active" onclick="showView('chatView', this)">üí¨ Chat</div>
<div class="nav-btn" onclick="showView('encryptView', this)">üîê Encrypt Tool</div>
</div>

<div class="main">

<!-- GROUP MENU -->
<div class="sidebar">
<h3>Groups</h3>
<div id="groupList"></div>
<button onclick="createGroup()">+ Create Group</button>
<button onclick="joinGroup()">Join Group</button>
</div>

<!-- CONTENT AREA -->
<div class="content">

<!-- CHAT VIEW -->
<div id="chatView">
<h2 id="chatTitle">No Group Selected</h2>
<div class="chat-box" id="chatBox"></div>

<textarea id="messageInput" rows="3" placeholder="Type message..."></textarea>
<button onclick="sendMessage()">Send Encrypted</button>
<button onclick="decryptAll()">Decrypt</button>

<div class="status" id="status"></div>
</div>

<!-- ENCRYPT TOOL VIEW -->
<div id="encryptView" class="hidden">
<h2>Quick Encrypt Tool</h2>

<textarea id="quickInput" rows="3" placeholder="Type message..."></textarea>
<button onclick="quickEncrypt()">Encrypt</button>
<button onclick="quickDecrypt()">Decrypt</button>
<textarea id="quickOutput" rows="3" placeholder="Output..."></textarea>

<div class="status" id="quickStatus"></div>
</div>

</div>
</div>

<script>
let groups = {};
let currentGroup = null;
let currentKey = null;
let quickKey = null;

/* View Switch */
function showView(viewId, btn){
document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");

document.getElementById("chatView").classList.add("hidden");
document.getElementById("encryptView").classList.add("hidden");

document.getElementById(viewId).classList.remove("hidden");
}

/* Status */
function setStatus(text){document.getElementById("status").innerText=text;}
function setQuickStatus(text){document.getElementById("quickStatus").innerText=text;}

/* Key */
async function deriveKey(password){
const enc=new TextEncoder();
const mat=await crypto.subtle.importKey(
"raw",enc.encode(password),
"PBKDF2",false,["deriveKey"]
);
return await crypto.subtle.deriveKey({
name:"PBKDF2",
salt:enc.encode("menuSalt"),
iterations:100000,
hash:"SHA-256"
},
mat,
{name:"AES-GCM",length:256},
false,
["encrypt","decrypt"]
);
}

/* Groups */
function refreshGroups(){
const list=document.getElementById("groupList");
list.innerHTML="";
for(let name in groups){
const div=document.createElement("div");
div.className="group";
div.innerText=name;
div.onclick=()=>openGroup(name);
list.appendChild(div);
}
}

async function createGroup(){
const name=prompt("Group name:");
const pass=prompt("Password:");
if(!name||!pass)return;
groups[name]={messages:[]};
currentKey=await deriveKey(pass);
currentGroup=name;
refreshGroups();
openGroup(name);
}

async function joinGroup(){
const name=prompt("Group name:");
const pass=prompt("Password:");
if(!groups[name]){setStatus("Group not found");return;}
currentKey=await deriveKey(pass);
currentGroup=name;
openGroup(name);
}

function openGroup(name){
currentGroup=name;
document.getElementById("chatTitle").innerText=name;
display();
}

/* Chat */
async function sendMessage(){
if(!currentGroup||!currentKey){setStatus("Join group first");return;}
const text=document.getElementById("messageInput").value;
if(!text)return;

const iv=crypto.getRandomValues(new Uint8Array(12));
const encoded=new TextEncoder().encode(text);
const encrypted=await crypto.subtle.encrypt(
{name:"AES-GCM",iv},
currentKey,
encoded
);

groups[currentGroup].messages.push({
iv:Array.from(iv),
data:Array.from(new Uint8Array(encrypted))
});

document.getElementById("messageInput").value="";
display();
}

function display(){
const box=document.getElementById("chatBox");
box.innerHTML="";
if(!currentGroup)return;

groups[currentGroup].messages.forEach(()=>{
const div=document.createElement("div");
div.className="msg";
div.innerText="Encrypted message";
box.appendChild(div);
});
}

async function decryptAll(){
if(!currentGroup||!currentKey){setStatus("Join group first");return;}

const box=document.getElementById("chatBox");
box.innerHTML="";

for(let m of groups[currentGroup].messages){
try{
const iv=new Uint8Array(m.iv);
const decrypted=await crypto.subtle.decrypt(
{name:"AES-GCM",iv},
currentKey,
new Uint8Array(m.data)
);
const text=new TextDecoder().decode(decrypted);

const div=document.createElement("div");
div.className="msg";
div.innerText=text;
box.appendChild(div);

}catch{
setStatus("Wrong password");
return;
}
}
}

/* Quick Tool */
async function quickEncrypt(){
if(!quickKey) quickKey=await deriveKey("quickSecret");
const iv=crypto.getRandomValues(new Uint8Array(12));
const encoded=new TextEncoder().encode(document.getElementById("quickInput").value);
const encrypted=await crypto.subtle.encrypt(
{name:"AES-GCM",iv},
quickKey,
encoded
);
const combined=new Uint8Array([...iv,...new Uint8Array(encrypted)]);
document.getElementById("quickOutput").value=btoa(String.fromCharCode(...combined));
}

async function quickDecrypt(){
try{
if(!quickKey) quickKey=await deriveKey("quickSecret");
const data=atob(document.getElementById("quickOutput").value);
const bytes=new Uint8Array([...data].map(c=>c.charCodeAt(0)));
const iv=bytes.slice(0,12);
const ciphertext=bytes.slice(12);

const decrypted=await crypto.subtle.decrypt(
{name:"AES-GCM",iv},
quickKey,
ciphertext
);
document.getElementById("quickInput").value=
new TextDecoder().decode(decrypted);
}catch{
setQuickStatus("Decrypt failed");
}
}
</script>

</body>
</html>
