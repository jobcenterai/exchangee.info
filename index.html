<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CryptoTracking Terminal</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}

body{
background:#0b1220;
color:#e5e7eb;
padding:40px 20px;
}

h1{
text-align:center;
font-size:24px;
font-weight:500;
margin-bottom:30px;
color:#f9fafb;
}

.container{
max-width:1100px;
margin:auto;
background:#111827;
border:1px solid #1f2937;
border-radius:10px;
overflow:hidden;
}

table{
width:100%;
border-collapse:collapse;
}

th{
font-size:12px;
text-transform:uppercase;
letter-spacing:0.05em;
font-weight:500;
color:#9ca3af;
padding:14px;
border-bottom:1px solid #1f2937;
cursor:pointer;
user-select:none;
}

td{
padding:16px 14px;
border-bottom:1px solid #1f2937;
font-size:14px;
}

tr:hover{
background:#0f172a;
}

.positive{color:#22c55e;}
.negative{color:#ef4444;}

canvas{
height:36px !important;
}

.footer{
margin-top:30px;
text-align:center;
color:#6b7280;
font-size:12px;
}
</style>
</head>
<body>

<h1>CryptoTracking Terminal</h1>

<div class="container">
<table id="table">
<thead>
<tr>
<th onclick="sortTable('name')">Asset</th>
<th onclick="sortTable('price')">Price (€)</th>
<th onclick="sortTable('change')">24h %</th>
<th>Trend</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="footer">
Real-Time Market Data · Sorted Client-Side
</div>

<script>
const assets = [
{ id:"bitcoin", stream:"btcusdt", name:"Bitcoin" },
{ id:"ethereum", stream:"ethusdt", name:"Ethereum" },
{ id:"litecoin", stream:"ltcusdt", name:"Litecoin" },
{ id:"ripple", stream:"xrpusdt", name:"XRP" }
];

let state = [];
let histories = {};
let sortDirection = 1;

function formatEUR(n){ return "€" + n.toFixed(2); }

function init(){
assets.forEach(a=>{
histories[a.stream]=[];
state.push({
name:a.name,
stream:a.stream,
price:0,
change:0
});
});
render();
startSockets();
refresh24h();
setInterval(refresh24h,60000);
}

function render(){
const tbody=document.querySelector("#table tbody");
tbody.innerHTML="";

state.forEach(row=>{
tbody.innerHTML+=`
<tr>
<td>${row.name}</td>
<td>${formatEUR(row.price)}</td>
<td class="${row.change>=0?'positive':'negative'}">${row.change.toFixed(2)}%</td>
<td><canvas id="chart-${row.stream}"></canvas></td>
</tr>`;
});

state.forEach(row=>drawChart(row.stream));
}

function startSockets(){
assets.forEach(a=>{
const ws=new WebSocket(`wss://stream.binance.com:9443/ws/${a.stream}@trade`);
ws.onmessage=(msg)=>{
let data=JSON.parse(msg.data);
let price=parseFloat(data.p)*0.92;
updatePrice(a.stream,price);
};
});
}

function updatePrice(stream,price){
let asset=state.find(a=>a.stream===stream);
asset.price=price;

histories[stream].push(price);
if(histories[stream].length>30) histories[stream].shift();

render();
}

async function refresh24h(){
const res=await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=eur&ids=bitcoin,ethereum,litecoin,ripple");
const data=await res.json();

const map={bitcoin:"btcusdt",ethereum:"ethusdt",litecoin:"ltcusdt",ripple:"xrpusdt"};

data.forEach(c=>{
let stream=map[c.id];
let asset=state.find(a=>a.stream===stream);
asset.change=c.price_change_percentage_24h;
});

render();
}

function drawChart(stream){
new Chart(document.getElementById("chart-"+stream),{
type:"line",
data:{labels:histories[stream],datasets:[{
data:histories[stream],
borderColor:"#3b82f6",
borderWidth:1.5,
pointRadius:0,
tension:0.3
}]},
options:{
responsive:true,
plugins:{legend:{display:false}},
scales:{x:{display:false},y:{display:false}}
}
});
}

function sortTable(key){
sortDirection*=-1;
state.sort((a,b)=>{
if(key==="name") return a.name.localeCompare(b.name)*sortDirection;
return (a[key]-b[key])*sortDirection;
});
render();
}

init();
</script>

</body>
</html>
